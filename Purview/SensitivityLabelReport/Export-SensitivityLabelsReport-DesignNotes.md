# Export-SensitivityLabelsAuditRecords HTML Report – Design Notes

This document captures the UI/UX notes, styling rationale, and tweak points for the interactive HTML report generated by `Export-SensitivityLabelsAuditRecords.ps1`.

## Features Overview
- Sortable columns with visual indicators (▲/▼)
- Global search and per-column filters (OR with `A|B`)
- Column visibility toggles (state saved in `localStorage`)
- Presets (Summary, Email, Files) + “Filter: Downgrades” button
- Summary metric tiles with icons and color cues
- Theme toggle (dark/light) with persisted preference
- “Export Visible CSV” downloads the current filtered/visible table

## Theming and Design Tokens
The report uses CSS variables to support dark/light themes and consistent accents.

Core variables:
- Base: `--bg`, `--elev`, `--text`, `--muted`, `--border`
- Accents: `--accent`, `--accent-strong`, `--accent-darker`
- Status: `--ok`, `--ok-strong`, `--ok-darker`; `--warn`, `--warn-strong`, `--warn-darker`; `--bad`, `--bad-strong`, `--bad-darker`; `--neutral`, `--neutral-strong`
- Additional: `--chip`, `--chip-border`, `--violet`, `--violet-strong`, `--violet-darker`

Change the default theme by updating the `:root` block; the light theme overrides live under `[data-theme="light"]`.

## Preset Buttons
- Summary: Blue accent (`--accent`)
- Email: Violet accent (`--violet`)
- Files: Warn/amber (`--warn`)
- Downgrades: Prominent danger color by default (`--bad-strong` → hover `--bad-darker`)

Implementation:
- Buttons have stable IDs (e.g., `#btn-preset-email`) so styles are targeted without new classes.
- Downgrades uses an ID selector by design to stand out visually.

To add a new preset:
1. Add a button in the HTML controls (near existing presets) with a unique `id`.
2. In JS, wire a click handler that:
   - Calls the visibility helper with a column name list, and/or
   - Sets per-column filter inputs via their column index, then
   - Calls `applyFilters()`.
3. Optionally add a CSS rule using theme variables for a distinctive color.

## Filters and OR Matching
- Global search matches entire row text.
- Per-column inputs support simple OR: enter `termA|termB` to match either substring (case-insensitive).
- Presets set column filters programmatically (e.g., Email sets `Document` to `Email:`; Files OR-filters common action names).

## Sorting and Indicators
- Sorting is client-side; clicking a header toggles ascending/descending.
- The TimeStamp column shows a descending indicator on load, matching the default newest-first order of the dataset.
- “Reset Sorting” restores the initial DOM row order; indicators are cleared.

To change initial indicator:
- In JS, after computing `colNames`, call `updateSortClasses(index, direction)` with the desired column index and direction.

## Summary Metric Tiles
- Tiles render a label and a large value; the border color reflects status:
  - New labels → ok
  - Changes/Sites/Opens/Renames → accent
  - Mismatches (>0) → warn; otherwise neutral
  - Removals (>0) → bad; otherwise neutral
  - Downgrades → bad
- Icons (emoji) for quick scanning:
  - Renames: 🔁  New labels: 🆕  Sites labeled: 🏷️  Changes: 🔄  Opens: 👁️
  - Mismatches: ⚠️  Removals: 🗑️  Downgrades: 📉

To change a tile’s style:
- Adjust the class mapping in the summary builder (look for `'metric ' + $cls`).
- Update the icon mapping in the same block.

## Chips and Badges
- `Application` and `Device` render as subtle “chips”.
- `LabelAction` renders as a colored badge (Upgraded/Downgraded/Removed/Same).

## Accessibility Notes
- Sorted headers get `aria-sort` updated to `ascending`/`descending`.
- Consider adding keyboard sorting shortcuts (e.g., Enter/Space on focused header) if needed.

## Default Ordering
- PowerShell sorts the dataset by `TimeStamp` descending before rendering.
- The JS “Reset Sorting” returns to this base order.

## Dev Tips
- The HTML template (CSS + JS) is embedded in the script as here-strings (`$css`, `$js`).
- Use theme variables for color consistency; avoid hard-coded hex where possible.
- Keep IDs stable for preset buttons and table structure.
- To slim the CSS for production, you can remove comments and whitespace without altering functionality.

## File Pointers
- Script path: `Purview/Export-SensitivityLabelsAuditRecords.ps1`
- CSS block: search for `$css = @'`
- JS block: search for `$js = @'`
- Summary tile generation: search for `$summaryCards = @()`
- Preset buttons markup: search for `btn-preset-` in the HTML builder

