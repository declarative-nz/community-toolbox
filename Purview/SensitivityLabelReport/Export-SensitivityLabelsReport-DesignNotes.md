# Export-SensitivityLabelsAuditRecords HTML Report – Design Notes

This reference captures the UI/UX decisions, styling rationale, and extension points for the interactive HTML report generated by `Export-SensitivityLabelsAuditRecords.ps1`.

## Features Overview
- Sortable column headers with CSS triangles (U+25B2/U+25BC) and a sticky filter row directly beneath the header.
- Global search plus per-column filters that support simple OR matching (`termA|termB`), with `Clear Filters` and `Reset Sorting` helpers.
- Column visibility toggles whose state is persisted to `localStorage` (`labelsReport:visibleCols`) and reset with `Reset Columns`.
- Preset buttons (Summary, Email, Files, Downgrades) that adjust column visibility and inject common filters in a single click.
- Summary metric cards that surface key counts with status-aware border colors and icon glyphs.
- Theme toggle that flips between dark/light modes and stores the preference in `localStorage` (`labelsReport:theme`).
- “Export Visible CSV” generates a CSV that respects both the current filters and the visible-column configuration.

## Theming and Design Tokens
The layout relies on CSS variables so both themes stay in sync:
- Base tokens: `--bg`, `--elev`, `--text`, `--muted`, `--border`
- Accent tokens: `--accent`, `--accent-strong`, `--accent-darker`
- Status tokens: `--ok*`, `--warn*`, `--bad*`, `--neutral*`
- Extras: `--chip`, `--chip-border`, `--violet*` (alternate accent for the Email preset)

Update the defaults in the `:root` block; override light-mode values in `[data-theme="light"]`.

## Header Logo
`New-InteractiveHtmlReport` accepts `-LogoUrl`, `-LogoUrlLight`, `-LogoUrlDark`, `-LogoHref`, and `-LogoAlt`. Provide either a single generic logo (`-LogoUrl`) or supply light/dark variants for better contrast. The script currently calls the helper with Declarative branding—swap these arguments to rebrand the header without touching the CSS.

## Preset Buttons
- Summary → accent blue (`--accent`)
- Email → violet (`--violet`)
- Files → warm amber (`--warn`)
- Downgrades → danger red (`--bad-strong`, hover `--bad-darker`)

Implementation notes:
- Buttons use fixed IDs (e.g., `#btn-preset-email`) so CSS can stay concise.
- Preset handlers call `applyPresetVisibility()` to toggle column checkboxes, optionally seed filter inputs via `setFilterByName()`, then invoke `applyFilters()`.
- The Downgrades button clears other filters and sets the `LabelAction` filter to “down” so both “Downgraded” label actions and variants match.

To add a preset:
1. Add a button next to the existing preset block with a new `id`.
2. Extend the JavaScript to register a click handler that sets visibility and filter values.
3. Optionally add a CSS rule that reuses the existing theme tokens (aim for IDs or utility classes, not inline styles).

## Filters and OR Matching
- Global search scans the full row text.
- Per-column inputs match the column text; the `A|B` syntax provides a simple OR split on the pipe character.
- Filter inputs sit in the second table header row and stay sticky beneath the main headers.
- `Clear Filters` wipes both global and column inputs. Resetting columns keeps filters intact unless a preset explicitly clears them.

## Sorting and Indicators
- Sorting is client-side; clicking a header toggles between ascending/descending.
- CSS classes `sort-asc` and `sort-desc` append the triangle indicators, and `aria-sort` is updated for assistive tech.
- `Reset Sorting` restores the original DOM order captured at load (newest-first, matching the PowerShell sort).
- The TimeStamp column receives the initial descending indicator by calling `updateSortClasses()` during initialization; change the default indicator there if you reorder columns.

## Summary Metric Tiles
- Each card renders `<div class="card metric {state}">` where `{state}` is chosen by label/value:
  - `ok` → “New labels”
  - `accent` → “Sites labeled”, “Changes”, “Opens”, “Renames”
  - `warn` → “Mismatches” when count > 0, otherwise `neutral`
  - `bad` → “Downgrades” and “Removals” when count > 0, otherwise `neutral`
- Icon glyphs use HTML entities to keep the source ASCII-friendly:
  - Renames `&#9998;` (pencil)
  - New labels `&#10133;` (heavy plus border)
  - Sites labeled `&#127760;` (globe)
  - Changes `&#8635;` (clockwise arrows)
  - Opens `&#128194;` (file folder)
  - Mismatches `&#9888;` (warning)
  - Removals `&#128465;` (trash bin)
  - Downgrades `&#11015;` (down arrow)
- To tweak styles or icons, edit the switch block near `$summaryCards +=` in the script.

## Chips and Badges
- `Application` and `Device` columns render as `.chip` spans for subtle pills.
- `LabelAction` becomes a `.badge` with semantic modifiers (`.up`, `.down`, `.removed`, `.same`). Adjust palettes inside the CSS near the `.badge` declarations.

## Persistence Keys
- Column visibility → `labelsReport:visibleCols`
- Theme preference → `labelsReport:theme`
- Resetting columns clears the stored visibility key; the theme key is updated by the toggle.

## Accessibility Notes
- Headers update `aria-sort` as sort state changes.
- Inputs and buttons are plain HTML controls; add keyboard shortcuts if future requirements demand deeper accessibility support.

## Default Ordering
- PowerShell pre-sorts the output by `TimeStamp` descending.
- The JavaScript snapshot (`baseOrder`) ensures `Reset Sorting` returns the table to that original order even after multiple sorts or filters.

## Dev Tips
- The CSS and JS live in here-strings (`$css`, `$js`) inside `Export-SensitivityLabelsAuditRecords.ps1`.
- Search for `$summaryCards = @()` to adjust metric generation or icon selection.
- Preset button markup lives in the HTML builder (look for `btn-preset-` IDs).
- When adding new columns, update the default `$Columns` array, extend preset lists, and ensure chip/badge styling covers the new values.
